# Linux Foundation Certified System Administrator (LFCS)

## Lesson 7 Permission

##### Основные разрешения

* Read
    - для файла - возможность читать
    - для директории - просматривать содержимое (ls), но не читать файлы
* Write
    - для файла - модифицировать
    - для директории - создавать/удалять файы внутри
* Execute  
    - для файла - запускать
    - для директории - выполнить команду cd

Команда `chmod`:

* каждое разрещение имеет числовое значение
    - read - 4
    - write - 2
    - execute - 1
* read + write + execute = 7; read + write = 6 и т. д.
* `chmod <ugo>` устанавливает разрешения для пользователя-владельца (u), группы-владельца (g) и других (o)
* напр. `chmod 666` - чтение/запись для всех
* можно в относительных значениях: `chmod g+w`

Установка владельцев:

* `chgrp` - изменить группу-владельца
* `chown` - изменить пользователь-владельца
 

##### Дополнительные ограничения

* suid (set user id) (4)
    - для файла - запускать от имени владельца, а не от имени текущего 
    пользователя (опасно!)
        + используется для команд, которые должны запускаться для обычного пользователя но с правами (напр. `passwd` установить себе пароль)
    - для директорий - не имеет значения
    - вывод `ls -l` для таких фалов имеет **s** `-rwsr-xr--`
* sgid (set group id) (2)
    - для файла - запуск от имени группы-владельца
    - для директории - файлы, создаваемые в каталоге будут иметь владельца-группу из директории, а не группу пользователя (удобно для общих папок)
* sticky-бит (1)
    - для файлов - не имеет значения
    - для директории - удалять файлы  внутри директории может только владелец этого файла (или владелец директории конечно) (удобно для общих папок, где все пользователи входят в группу-владельца и поэтому имеют права на запись(а значит и на удаление))
    - по умолчанию установлен для `/tmp`
* изменение командой `chmod 1777` (четыре цифры, первая - доп. ограничения)
* в относительных `chmod g+s` - для sgid; `chmod +t` - для sticky 


#### Access control list

* Дополнительное средство для установки разрешений
* позволяет конкретным группам давать конкретные права
* 2 типа:
    - обычный - применяется к существующим файлам
    - по умолчанию - для новых создаваемых
* команда `setfacl -R -m g:<имя группы>:<права> <имя файла/директории>` устанавливает рекурсивно обычные права для файлов
* `setfacl -R -m d:g:<имя группы>:<права> <файл/дир>` - устанавливает права по умолчанию
* в конкретной файловой системе должна быть поддержка ACL
* при вызове `ls -l` на директорию с ACL будет `+` в конце, типа `drwxws--T+`
* `getfacl <имя файла>` вывод список установленных прав


#### Расширенные атрибуты файлов

* атрибуты касаются только файлов, без привязки к пользователям
* пример атрибутов: read only, immutable
* действуют для всех пользователей, даже для root (хотя root может убирать атрибуты)
* требуется поддержка от файловой системы (настройка user_xattr)
* команда `chattr` устанавливает атрибуты, `lsattr` - вывод
* список атрибутов см. `man chattr`

#### Квоты файловой системы

* определяет размер дискового пространства, доступного пользователю
* зависит от типа файловой системы
* вводятся ограничения на количество блоков и/или количество айнодов (файлов)
* нужно устанавливать, включать поддержку
* просмотр квот `repquota -aug` для etc4

#### Поиск файлов по ограничениям

* `find -perm mode` - конкретные ограничения (напр. `find -perm 0770`)
* `find -perm -mode` - указанные биты установлены, остальные не важны (напр. `find -perm 0770`)
* `find -perm /mode` - любой из битов установлен (напр. `find -perm 0770`)
* `find / -perm /4000 -exec ls -l {}\;` - вывод файлов с установленным suid (контроль над такими файлами)

