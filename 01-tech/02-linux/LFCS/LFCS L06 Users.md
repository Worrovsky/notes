# Linux Foundation Certified System Administrator (LFCS)

## Lesson 6

#### Общее

* Каждый файл / директория имеет владельца-пользователя и владельца-группу
* можно увидеть через `ls -l`
* Пользователи принадлежат к одной или нескольким группам
* команда `id` (`id <имя пользователя>` для root) показывает инфо о пользователе, в т. ч. группы
* у кажого пользователя есть первичная (primary) группа, она будет владельцем файлов, которые создает пользователь
* группы определяют к каким файлам имеет доступ пользователь

##### Просмотр пользователей и групп

    cat /etc/passwd
    cat /etc/group

#### Создание пользователей

* команда `useradd`
* `useradd -D` - список опций по умолчанию, с которыми будет создаваться пользователь (home directory, группа, срок действия, оболочка)
* по умолчанию для пользователя создается группа с таким же наименованием  устанавливается основной
* пароль НЕ устанавливается через параметр `useradd -p ...`
* пароль устанавливается командой `passwd`

* команда `adduser`
* интерактивный вариант с выводом информации и запросом на ввод

#### Создание групп и добавление пользователей

* `groupadd <имя группы>` - добавляет новую группу
* `groupadd -g` - создать группу с указанием ид (не обязательно, присваиваются авто)

Добавление пользователя в группу:

* через `useradd`
* через `usermod`
    - `usermod -g ...` - установить новую первичную группу
    - `usermod -G ...` - установить новый список дополнительных групп
    - `usermod -aG <группа> <пользователь>` - добавить группу

#### Работа с пользователями и группами

* `usermod -L` - заблокировать пользователя (не сможет выполнять вход)
* `usermod -U` - разблокировать
* `userdel` - удалить пользователя
    - рекомендуется `userdel -r` (`userdel --remove`) - с удалением домашней директории

* `groupdel` - удаление группы
* `groupmod` - изменение группы (но параметров у групп почти нет, кроме id)

#### Настройки по умолчанию при создании пользователей

* показывает `useradd -D`, она же изменяет
* хранятся `/etc/default/useradd`
* настройки по умолчанию:
    - GROUP
    - HOME
    - INACTIVE
    - EXPIRE
    - SHELL
    - SKEL - содержимое этой директории будет скопировано в home
* дополнительные настройки в `/etc/login.defs`
* имеют приоритет перед настройками useradd
* содержит:
    - настройки паролей (срок действия, мин. длину)
    - диапазоны ид для пользователей и групп
        + системные 201-999
        + пользовательские 1000-60000 
    - создавать или нет home директории
    - создавать или нет группу с именем пользователя
* `/etc/skell` - содержимое копируется в home
* содержит скрытые файлы

#### Управление паролями

* `passwd` - устанавливает, удаляет или изменяет параметры паролей (время жизни, активность/неактивность, блокирует/разблокирует, дней для предупреждения перед заменой пароля)
* `passwd -S` - статус пароля
* установка пароля через скрипт
    -  `echo <pass> | passwd --stdin <user>`
* команда `chage <user>` - интерактивный вариант для изменения параметров пароля

#### Конфигурационные файлы пользователей

При создании / настройке пользователей данные записываются в файлы:
* `/etc/passwd`
    - содержит id, gid, home dir/ shell
* `/etc/shadow`
    - содержит хеш пароля, срок действия пароля, дни предупреждения

Редактирование файлов:
    * `vipw` - открывает копию `/etc/passwd`, по окончании редактирования переносит изменения в основной
    * `vipw -s` - аналогично для `/etc/shadow`
    * не рекомендуется напрямую редактировать, лучше через `chage`

#### Конфигурационные файлы групп

* `/etc/group`
    - содержит имя, пароль, id, список пользователей, входящих в группу
    - для первичных групп пользователь не указан (видно в файле `/etc/passwd`)
    - пароль группы сейчас не используется

#### Ограничения доступа к ресурсам

* `/etc/security/limits.conf`
* позволяет настраивать доступ к ресурсам для группы пользователей
    - время процессора
    - макс. число запущенных процессов
    - макс. число входов в систему и т.п.
* два типа ограничений:
    - soft - предупреждения при превышении ресурса
    - hard - жесткое ограничение 